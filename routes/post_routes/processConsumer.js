/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const logger = require('../../config/logger')
const config = require('../../init_config');
const pool = require('../../init_db_pool');
const bh = require('../../etran/ConsumerHandler');
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
var appRouter = async function (app) {
    app.post(`/${config.SYSTEM.restConfig.etranService.name}`, async function (req, res) {

        const end = httpRequestDurationMicroseconds.startTimer();
        const route = req.route.path;

        var eventResult = `<responseClaim><status>1</status><message>Error in request process</message></responseClaim>`;   // Default response (filled manually for reliability)
        try {
            eventResult = await bh.consumerHandler(req, res, client, config);
        } catch (e) {
            logger.error(e);
        } finally {
            await res.send(eventResult);

            // End timer and add labels
            end({ route, code: res.statusCode, method: req.method });
        }
    });
}
module.exports = appRouter;
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////